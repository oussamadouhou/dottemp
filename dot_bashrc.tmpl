{{- if ne .chezmoi.os "windows" -}}
# ~/.bashrc - Bash configuration managed by chezmoi

# If not running interactively, don't do anything
case $- in
    *i*) ;;
      *) return;;
esac

# History configuration
HISTCONTROL=ignoreboth
HISTSIZE=10000
HISTFILESIZE=20000
shopt -s histappend

# Check window size after each command
shopt -s checkwinsize

# Enable programmable completion
if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi

# Color prompt
if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
    PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
else
    PS1='\u@\h:\w\$ '
fi

# Aliases
{{ template "shell_aliases" . }}

# Functions
{{ template "shell_functions" . }}

# Editor
export EDITOR={{ if eq .chezmoi.os "windows" }}"code"{{ else }}"nvim"{{ end }}
export VISUAL="$EDITOR"

# Mise activation
if command -v mise &> /dev/null; then
    eval "$(mise activate bash)"
fi

# Starship prompt (if available)
if command -v starship &> /dev/null; then
    eval "$(starship init bash)"
fi

# FZF configuration
if command -v fzf &> /dev/null; then
    export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    [ -f ~/.fzf.bash ] && source ~/.fzf.bash
fi

{{ if eq .chezmoi.os "darwin" -}}
# macOS-specific configuration
{{ if eq .chezmoi.arch "arm64" -}}
# Apple Silicon Homebrew
eval "$(/opt/homebrew/bin/brew shellenv)"
{{ else -}}
# Intel Homebrew
eval "$(/usr/local/bin/brew shellenv)"
{{ end -}}
{{ end -}}

# Local customizations (not tracked by chezmoi)
[ -f ~/.bashrc.local ] && source ~/.bashrc.local
{{ end -}}
