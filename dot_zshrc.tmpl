{{- if ne .chezmoi.os "windows" -}}
# ~/.zshrc - Zsh configuration managed by chezmoi

# Path to oh-my-zsh installation
export ZSH="$HOME/.oh-my-zsh"

# Theme
ZSH_THEME="powerlevel10k/powerlevel10k"

# Plugins
plugins=(
    git
    docker
    kubectl
    terraform
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Load Oh My Zsh (if available)
if [ -f "$ZSH/oh-my-zsh.sh" ]; then
    source "$ZSH/oh-my-zsh.sh"
fi

# History configuration
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt SHARE_HISTORY

# Case-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

# Editor
export EDITOR={{ if eq .chezmoi.os "windows" }}"code"{{ else }}"nvim"{{ end }}
export VISUAL="$EDITOR"

# Language
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

{{ if eq .chezmoi.os "darwin" -}}
# macOS-specific PATH configuration
{{ if eq .chezmoi.arch "arm64" -}}
# Apple Silicon Homebrew
eval "$(/opt/homebrew/bin/brew shellenv)"
{{ else -}}
# Intel Homebrew
eval "$(/usr/local/bin/brew shellenv)"
{{ end -}}
{{ end -}}

{{ if eq .chezmoi.os "linux" -}}
# Linux-specific PATH
export PATH="$HOME/.local/bin:$PATH"
{{ end -}}

# Mise activation
if command -v mise &> /dev/null; then
    eval "$(mise activate zsh)"
fi

# Starship prompt (overrides Oh My Zsh theme if present)
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# FZF configuration
if command -v fzf &> /dev/null; then
    export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
fi

# Aliases
{{ template "shell_aliases" . }}

# Functions
{{ template "shell_functions" . }}

{{ if .devmachine -}}
# Development environment variables
export COMPOSE_DOCKER_CLI_BUILD=1
export DOCKER_BUILDKIT=1

# Kubectl completion
if command -v kubectl &> /dev/null; then
    source <(kubectl completion zsh)
fi
{{ end -}}

# eza (modern ls replacement) configuration
if command -v eza &> /dev/null; then
    alias ls='eza'
    alias ll='eza -la'
    alias lt='eza --tree'
fi

# bat (modern cat replacement) configuration
if command -v bat &> /dev/null; then
    alias cat='bat'
    export BAT_THEME="Dracula"
fi

# Local customizations (not tracked by chezmoi)
[ -f ~/.zshrc.local ] && source ~/.zshrc.local

# Powerlevel10k instant prompt (must be at the end)
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh
{{ end -}}
